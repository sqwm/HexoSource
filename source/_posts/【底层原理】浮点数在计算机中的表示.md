---
title: 【底层原理】浮点数在计算机中的表示
date: 2019-02-22 13:26:52
tags: C
toc: true
mathjax: true
categories: 底层原理
thumbnail: 'https://gss1.bdstatic.com/-vo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike116%2C5%2C5%2C116%2C38/sign=56b6ed04f8dcd100d991f07313e22c75/5366d0160924ab18fa5aa63e35fae6cd7b890b6e.jpg'
comments: ture
---
# 一道C语言题：

<!-- more -->

```c++
#include <stdio.h>
int main()
{
    int num = 9;
    float *pFloat = &num;
    printf("num 的值为：%d\n",num);
    printf("*pFloat 的值为：%f\n",*pFloat);

    *pFloat = 9.0;
    printf("num 的值为：%d\n",num);
    printf("*pFloat 的值为：%f\n",*pFloat);

    return 0;
}

```
运行结果：
![](http://hexoblog-1257022783.cos.ap-chengdu.myqcloud.com/%E3%80%90%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E3%80%91%E6%B5%AE%E7%82%B9%E6%95%B0%E5%9C%A8%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%AD%E7%9A%84%E8%A1%A8%E7%A4%BA/20190222014746020.png)

**产生上述结果的原因：浮点数在计算机中的表示与整数在计算机中的表示存在差异**

---
### 分析：
#### 整数在计算机中的表示：
```c
int num = 9;
```
上面这条语句声明并定义了一个整型int变量num为9；在普通的32位计算机中，用四个字节表示int，其二进制表示为：
>> 00000000 00000000 00000000 00001001

#### 浮点数在计算机中的表示：
根据国际标准IEEE 754，任意一个二进制浮点数V可以表示为下面这种形式：
>>  $ V = (-1)^{s} · M · 2^{E} $
> * s表示符号位，s=0为正，s=1为负；
> * M为有效数字，$1<= M <2$;
> * $2^E$表示指数位； 

如题例，十进制的 $ 9.0 $ ,写成二进制位$1001.0$,相当于：$ 1.001 · 2^{3} $,其中$ s=0,M=1.001,E=3 $;
十进制的$ -9.0 $,写成二进制为$ -1001.0 $,相当于：$ -1.001 · 2^{3} $,其中$ s=1,M=1.001,E=3 $;

**有效数字M：**

IEEE 745规定，对于32位的浮点数，最高的一位是符号位s，接着的8位是指数E，剩下的23位为有效数字M：
![32bIt](http://hexoblog-1257022783.cos.ap-chengdu.myqcloud.com/%E3%80%90%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E3%80%91%E6%B5%AE%E7%82%B9%E6%95%B0%E5%9C%A8%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%AD%E7%9A%84%E8%A1%A8%E7%A4%BA/20190222022411070.png)
对于64位的浮点数来说，最高的一位仍为符号位s，接着的11位是指数E，剩下的52位为有效数字M：
![64bit](http://hexoblog-1257022783.cos.ap-chengdu.myqcloud.com/%E3%80%90%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E3%80%91%E6%B5%AE%E7%82%B9%E6%95%B0%E5%9C%A8%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%AD%E7%9A%84%E8%A1%A8%E7%A4%BA/20190222023402771.png)
另外，前面提到，$1<= M <2$,也就是说M可以写成$1.x_1x_2x_3x_4$的形式，其中$x_1x_2x_3x_4$表示小数部分。IEEE 754规定，在计算机内包存M时， 默认这个数的第一位为 1，因此可以被舍去，这样子就可以节省一位有效数字位，使得32（64）位浮点数可以保存24（53）位的有效数字。

**指数E的情况稍微复杂一些：**

首先，E是一个无符号整数（unsign int ）,着意味着当E为8位时，其取值范围为0到255；若E为11位其取值范围为0到2047。但是我们知道，科学计数法中的E可以是负数，因此，E的真实值必须减去一个中间值。对于8位的E应减去127，对于11位的E应减去1023；

比如说，$ 2^{9} $ 的E是9，所以保存成32位浮点数时，必须保存为$E = 9+127=136$,即$10001000$。

**还原E的真实值时还可以分成3种情况：**

1. E不全为0或不全为1:。这时可直接用E减去127（1023）即可得到E的真实值。
2. E全为0。这时浮点数的指数E为1-127（1-1023），有效数字M不再加上第一位，而是还原成$0.x_1x_2x_3x_4$的小数。这样做是为了表示$\pm0$,以及接近于0的很小的数字。
3. E全为1。这时如果有效数字M全为0，则表示$\pm$无穷大（取决于符号位s）；如果有效数字M不全为0，表示这个数是一个$NaN$。

---

到此，回顾最初的问题。
1. 为什么$00000000 00000000 00000000 00001001$还原成浮点数就变成了$0.000000$ 呢???
首先：00000000 00000000 00000000 00001001的符号位s为0表示其为正；
再者：00000000 00000000 00000000 00001001的指数位E为00000000（全为0），符合第2种情况，还原后的E的真实值为：$E=1-127=-126$；
最后：00000000 00000000 00000000 00001001的有效数字位为：$000 0000 0000 0000 0000 1001$。
综上：$V = (-1)^{0} · 0.00000000000000000001001 · 2^{-126} = 1.001 · 2^{-146}$
可以看出这是一个很小的数，故用十进制表示为0.000000.

2. 浮点数9.0如何用二进制表示，还原成十进制后为何是1092567616 呢？
首先：浮点数9.0的二进制表示为1001.0，即为$1.001 · 2^3$；符号位s=0；
再者：有效数字M=100 0000 0000 0000 0000 0000（共23位（100后加上20个0）其中最高位1默认被省略）。
最后：指数E=3+127=130，即$E = 10000010_{BIN}$。
综上：浮点数9.0在计算机内的表示为：$0 10000010 00100000000000000000000$，将其转化为十进制就是：1091567616
![](http://hexoblog-1257022783.cos.ap-chengdu.myqcloud.com/%E3%80%90%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E3%80%91%E6%B5%AE%E7%82%B9%E6%95%B0%E5%9C%A8%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%AD%E7%9A%84%E8%A1%A8%E7%A4%BA/20190222033629845.png)